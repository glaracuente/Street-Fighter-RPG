<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <title>Street Fighter</title>
</head>

<body>
    <header>
        <h1>Street Fighter RPG</h1>
    </header>

    <div id="pregame">
    </div>

    <section id="fightRing">

        <div id="yourCharDiv">
            <!--div to actually "your characters"-->
            <h2>Your Character</h2>

            <!--div to actually place chosen character-->
            <div id="yourCharacter"></div>
        </div>
        <div id="defenderDiv">

            <!--div for "defender"-->
            <h2>Defender</h2>

            <!--div to actually move chars from available to defender section-->
            <div id="defender"></div>
        </div>

    </section>

    <div id="enemiesDiv">

        <!--div for "enemies to attack"-->
        <h2>Enemies Available To Attach</h2>

        <!--div for actually placing 3 enemies to attack-->
        <div id="enemyRoster"></div>
    </div>

    <!--div for fight section-->
    <h2>Fight Section</h2>

    <!--div for attack button-->
    <div id="attackButton">Attack</div>



    <!--div to display game info -->
    <div id="info"></div>

    <!--div for restart button-->
    <div id="restartButton">Restart</div>





    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

        //NEED TO MOVE THIS INTO JS FILE IN THE END

        $(document).ready(function () {
            var fighterNames = ["Ryu", "Blanka", "Guile", "Dhalsim"];
            var backs = ["back1", "back2","back1", "back2"];
            var fighterHPs = [300, 350, 275, 325];
            var fighterAttacks = [30, 20, 15, 10];
            var fighterCounters = [25, 30, 45, 20];
            var fighterObjects = [];
            var yourChar;
            var currentEnemy;

            var initCharObjects = function () {
                fighterObjects = [];

                for (var i = 0; i < fighterNames.length; i++) {
                    var fighter = {
                        name: "",
                        pic: "",
                        back: "",
                        health: 0,
                        attackPower: 0,
                        baseAttackPower: 0,
                        counter: 0,
                        attack: function () {
                            this.attackPower = this.attackPower + this.baseAttackPower;
                        },
                        setBaseAttackPower: function () {
                            this.baseAttackPower = this.attackPower;
                        }
                    };

                    fighter.name = fighterNames[i];
                    fighter.back = backs[i];
                    fighter.pic = "assets/images/" + fighterNames[i].toLowerCase() + ".png";
                    fighter.health = fighterHPs[i];
                    fighter.attackPower = fighterAttacks[i];
                    fighter.counter = fighterCounters[i];
                    fighter.setBaseAttackPower();
                    fighterObjects.push(fighter);
                }
            }

            var initHTML = function () {

                for (var i = 0; i < fighterObjects.length; i++) {
                    var fighterDisplay = $("<section>")
                    fighterDisplay.addClass("fighterBox")
                    var fighterName = $("<div>")
                    fighterName.addClass("fighterName")
                    fighterName.text(fighterObjects[i].name)
                    var fighterImg = $("<img>")
                    fighterImg.addClass("fighterImg")
                    fighterImg.attr("src", fighterObjects[i].pic)
                    //$("#win-lose").html("<h2>Winner!</h2>") CAN TRY THIS TOO
                    var fighterHP = $("<div>")
                    fighterHP.addClass("fighterHP")
                    fighterHP.text(fighterObjects[i].health)
                    fighterDisplay.append(fighterName)
                    fighterDisplay.append(fighterImg)
                    fighterDisplay.append(fighterHP)
                    fighterDisplay.data("fighter", fighterObjects[i])
                    $("#pregame").append(fighterDisplay)
                }

                $("#restartButton").css('visibility', 'hidden')
                $("#attackButton").css('visibility', 'hidden')
                $("#fightRing").css('visibility', 'hidden')

                $("#info").empty()
                $("#yourCharacter").empty()
                $("#enemyRoster").empty()
                $("#defender").empty()

            }

            initCharObjects();
            initHTML();

            $(".fighterBox").on("click", function () {
                if ($("#pregame")[0].childElementCount === 4) {
                    $("#yourCharacter").append($(this))
                    $($($("#yourCharacter")[0].firstChild).find(".fighterName")).css({"background-color":"rgb(37, 3, 128)","color":"white"})
                    $($($("#yourCharacter")[0].firstChild).find(".fighterHP")).css({"background-color":"rgb(37, 3, 128)","color":"white"})
                    yourChar = jQuery.data($("#yourCharacter")[0].firstChild, "fighter")
                    //$("#fightRing").css('background-image', "url(assets/images/ready.png)")
                    $("#fightRing").css('visibility', 'visible')
                    $("#enemyRoster").append($("#pregame").children().detach())
                }
                //move enemy to defense area...only if clicking on a fighter in enemy roster, and there is no current defender
                else if ($("#enemyRoster").has($(this)).length && $("#defender")[0].childElementCount === 0) { //WHY DO I NEED LENGTH FOR THIS TO WORK PROPERLY?
                    //make attach button appear only when the first defender is chosen
                    if ($("#enemyRoster")[0].childElementCount === 3) {
                        $("#attackButton").css('visibility', 'visible')
                    }
                    $("#fightRing").css('background-image', "url(assets/images/" + yourChar.back +".gif)")
                    $("#defender").append($(this))
                    $($($("#defender")[0].firstChild).find(".fighterName")).css({"background-color":"red","color":"black"})
                    $($($("#defender")[0].firstChild).find(".fighterHP")).css({"background-color":"red","color":"black"})
                    $($($("#defender")[0].firstChild).find(".fighterImg")).addClass("img-hor")
                    $($("#enemyRoster")[0].children).css({ "background-color": "black", "color": "white" })
                    currentEnemy = jQuery.data($("#defender")[0].firstChild, "fighter")
                }
            });


            $("#attackButton").on("click", function () {
                if ($("#defender")[0].childElementCount === 0) {
                    $("#info").html("<p>No enemy here.</p>")
                    return
                }

                $("#info").html("<p>You attacked " + currentEnemy.name + " for " + yourChar.attackPower + " damage.</p><p>" + currentEnemy.name + " attacked you back for " + currentEnemy.counter + " damage.</p>")
                currentEnemy.health = currentEnemy.health - yourChar.attackPower
                yourChar.attack()
                yourChar.health = yourChar.health - currentEnemy.counter
                $(".fighterHP", $("#yourCharacter")[0].firstChild).text(yourChar.health)
                $(".fighterHP", $("#defender")[0].firstChild).text(currentEnemy.health)

                if (currentEnemy.health <= 0) {
                    $("#info").html("<p>You have defeated " + currentEnemy.name + ", you can choose to fight another enemy.</p>")
                    $("#defender").empty()
                }

                if (yourChar.health <= 0) {
                    $("#info").html("<p>You have been defeated...GAME OVER!!!</p>")
                    $("#restartButton").css('visibility', 'visible')
                }

                if ($("#enemyRoster")[0].childElementCount === 0 && $("#defender")[0].childElementCount === 0) {
                    $("#info").html("<p>You won!!!! GAME OVER!!!</p>")
                    $("#restartButton").css('visibility', 'visible')
                }

            });


            $("#restartButton").on("click", function () {
                initCharObjects();
                initHTML();
            });

        });


        //NEED TO MAKE VARIABLE NAMES BETTER
        //FUNCTIONS AND VARIABLES TO MAKE CODE MORE READABLE/EFFICIENT
        //NEED BETTER VISUALS! (background...make them flash when hit....sounds when attacking)
        //make mobile responsive
        //function to start the entire game (happens on page refresh)





    </script>
</body>

</html>